<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Profil — Spotykaj</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body data-requires-auth="true">

<header class="nav">
  <div class="container nav-inner">
    <a class="brand" href="index.html">spotykaj</a>
    <nav class="nav-links">
      <a class="btn btn-ghost" href="app.html">Aplikacja</a>
      <button id="logoutBtn" class="btn btn-ghost">Wyloguj</button>
    </nav>
  </div>
</header>

<main class="container page">
  <div class="box">
    <h1>Profil</h1>
    <p class="muted">Uzupełnij podstawowe informacje. (Demo – zapis lokalny w przeglądarce)</p>

    <div class="grid2">
      <div class="card">
        <div class="card-title">Zdjęcie profilowe</div>

        <div class="profile-photo">
          <img id="photoPreview" alt="Podgląd zdjęcia" />
          <div id="photoPlaceholder" class="muted small">Brak zdjęcia</div>
        </div>

        <input id="photoInput" type="file" accept="image/*" />
        <p class="small muted">Zdjęcie jest zapisywane lokalnie (Base64). Później podmienimy na prawdziwy upload.</p>
      </div>

      <div class="card">
        <div class="card-title">Dane</div>

        <form id="profileForm" class="form">
          <label>Imię</label>
          <input id="p_name" type="text" placeholder="np. Ania" required />

          <label>Wiek</label>
          <input id="p_age" type="number" min="18" max="99" placeholder="np. 28" required />

          <label>Miasto</label>
          <input id="p_city" type="text" placeholder="np. Warszawa" required />

          <label>Opis (bio)</label>
          <textarea id="p_bio" rows="4" placeholder="Krótko o Tobie…"></textarea>

          <button class="btn btn-primary" type="submit">Zapisz profil</button>
          <div id="savedMsg" class="small" style="display:none;margin-top:10px;">✅ Zapisano</div>
        </form>
      </div>
    </div>

    <p class="small muted" style="margin-top:14px;">
      Wskazówka: to jeszcze MVP. Następny krok: „Przeglądaj profile” + „Polubienia i matche”.
    </p>
  </div>
</main>

<script src="js/app.js"></script>
<script>
  // --- Profile page logic (local demo) ---
  const KEY_PROFILE = "spotykaj_profile";
  const form = document.getElementById("profileForm");
  const savedMsg = document.getElementById("savedMsg");

  const p_name = document.getElementById("p_name");
  const p_age  = document.getElementById("p_age");
  const p_city = document.getElementById("p_city");
  const p_bio  = document.getElementById("p_bio");

  const photoInput = document.getElementById("photoInput");
  const photoPreview = document.getElementById("photoPreview");
  const photoPlaceholder = document.getElementById("photoPlaceholder");

  let profile = {};
  try { profile = JSON.parse(localStorage.getItem(KEY_PROFILE) || "{}"); } catch(e){ profile = {}; }

  function renderPhoto(dataUrl){
    if (dataUrl) {
      photoPreview.src = dataUrl;
      photoPreview.style.display = "block";
      photoPlaceholder.style.display = "none";
    } else {
      photoPreview.removeAttribute("src");
      photoPreview.style.display = "none";
      photoPlaceholder.style.display = "block";
    }
  }

  // Prefill
  if (profile?.name) p_name.value = profile.name;
  if (profile?.age)  p_age.value  = profile.age;
  if (profile?.city) p_city.value = profile.city;
  if (profile?.bio)  p_bio.value  = profile.bio;
  renderPhoto(profile?.photo || "");

  photoInput.addEventListener("change", async (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      profile.photo = reader.result;
      renderPhoto(profile.photo);
      localStorage.setItem(KEY_PROFILE, JSON.stringify(profile));
      savedMsg.style.display = "block";
      setTimeout(()=> savedMsg.style.display="none", 1500);
    };
    reader.readAsDataURL(file);
  });

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    profile.name = p_name.value.trim();
    profile.age  = Number(p_age.value);
    profile.city = p_city.value.trim();
    profile.bio  = p_bio.value.trim();

    localStorage.setItem(KEY_PROFILE, JSON.stringify(profile));
    savedMsg.style.display = "block";
    setTimeout(()=> savedMsg.style.display="none", 1500);
  });
</script>

</body>
</html>